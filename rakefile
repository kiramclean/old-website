require 'rubygems'
require 'tmpdir'

desc 'Generate website'
task :generate do
  # Specify the name of the theme you want to use here
  theme_to_use = 'simple'
  system "hugo -t #{theme_to_use}"
end

desc 'Publish the generated website to github pages'
task publish: :generate do
  # Clean public directory to clear out stale code
  FileUtils.rm_rf(Dir.glob('public/*'))

  Dir.mktmpdir do |tmp|
    # Change to your git username
    github_username = 'kiramclean'

    cp_r 'public/.', tmp

    pwd = Dir.pwd
    Dir.chdir tmp

    system 'git init'
    system 'git add .'
    message = "Site publised at #{Time.now.utc}"
    system "git commit -m #{message.inspect}"
    system "git remote add origin git@github.com:#{github_username}/#{github_username}.github.io.git"
    system 'git push origin master --force'

    Dir.chdir pwd
  end
end
