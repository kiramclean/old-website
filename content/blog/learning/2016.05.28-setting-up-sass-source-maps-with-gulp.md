+++
date = "2016-05-28T23:55:06-04:00"
title = "Setting Up Sass Source Maps With Gulp"
+++

Using sourcemaps with your sass files makes your front-end workflow even more awesome. With source maps you can make changes to your sass files directly in Chrome's browser inspector and save them directly to the actual files. No more tweaking design in the inspector and then trying to find the right place among your list of sass files to add those changes to your project. Source maps also make debugging CSS issues super simple because clicking on the style definition for an element will take you right to the line of sass where that style is defined -- not to a compiled (maybe minified) huge CSS file. Adding source maps to your project is really simple, especially if you already have tools in place to compile your sass files. I use [gulp to compile my sass files]({{<relref "2016.04.27-setting-up-gulp-for-css-pre-and-post-processing.md" >}}) already, so adding sourcemaps was easy. Check out that post if you don't already have gulp set up in your project.

## Add Source Maps to Your Sass Pipeline

First, get the sourcemap builder for gulp.

```bash
# in your project directory, where your gulpfile.js is
npm install --save-dev gulp-sourcemaps
```

Then add sourcemaps to your gulpfile. Require it at the top with the other tools:

```js
var sourcemaps = require('gulp-sourcemaps');
```

Then pipe your sass files into the sourcemaps initializer before they're compiled and write the sourcemaps right before they're output. You're whole `gulp.task('sass')` should look something like this:

```js
gulp.task('sass', function() {
  return gulp
    .src(input)
    .pipe(sourcemaps.init())
    .pipe(sass().on('error', sass.logError))
    .pipe(sourcemaps.write('./'))
    .pipe(gulp.dest(output));
});
```

You can change the output location for the sourcemap file by passing a relative path in this line:

```js
.pipe(sourcemaps.write('/your/custom/path/here'))
```

If you do not pass anything to `.write()`, `gulp-sourcemaps` will write the sourcemaps inline by default. IMO it's nicer to have them all in one file so you can `.gitignore` it and not interfere with any teammates' development environments. [Gulp sass has lots of other options](https://www.npmjs.com/package/gulp-sourcemaps) you can check out to customize it exactly how you want.

## Enable Sourcemaps in Chrome

To take full advantage of sourcemaps you have to tell Chrome that your compiled CSS has them by enabling a setting. Open the inspector, go to settings (press F1), scroll down to "Sources" and check "Enable CSS source maps" and "Auto-reload generated CSS". While you're here, you can adjust the default spacing to make it the same as your editor to avoid having different indentation between files edited in your editor and in Chrome's workspace.

{{< figure src="/images/source_maps/enable_source_maps.png" alt="Enabling source maps in Google Chrome" caption="Enabling source maps in Chrome" class="smaller" >}}

## Tell Chrome Where to Find Your Files

I mentioned that with sourcemaps you can edit files directly in the inspector and have those changes persisted to the actual files. To make this happen you need to tell the Chrome workspace where on your machine it can find the files to write your changes to. Open up your project in Chrome, either directly or on a local server, then open up the inspector. If you refresh your web page once you have `gulp-sourcemaps` set up and go to the "Sources" tab, you should see a friendly prompt from Chrome to guide you:

{{< figure src="/images/source_maps/serving_from_the_file_system.png" alt="Google prompt asking about serving from the file system" class="smaller" >}}

If you don't see this that's fine, just go ahead and either drag your folder with the sass files for your project in it into the workspace or right-click in the sources pane and select "Add Folder to Workspace":

{{< figure src="/images/source_maps/add_folder_to_workspace.png" alt="Add a local folder to Google Chrome workspace" class="smaller" >}}

Make sure that you give Chrome access to the folder when it asks:

{{< figure src="/images/source_maps/chrome_access_request.png" alt="Give Google Chrome access to the folder" class="padded" >}}

Then, refresh your page and inspect something. You should see your source maps in action!

{{< figure src="/images/source_maps/woohoo_source_maps.png" alt="Source maps showing links to sass files" caption="Woohoo! Source maps are awesome." class="smaller" >}}

There's still one last thing to do to enable one of the coolest features of sourcemaps -- editing in the Chrome workspace. If you click on one of the links beside the style definitions in your inspector, Chrome will take you to the corresponding file in your workspace. Try it out and you will probably see a prompt like this one:

{{< figure src="/images/source_maps/map_prompt.png" alt="Google asking to map network resources" class="smaller" >}}

If you do, click the link to "Establish the mapping now...". Chrome is pretty smart so once you map one file it will most likely pick up on the rest of your files automatically and map them to the corresponding network resources. If you don't see this prompt or you need to create the mapping between your local files and the network files manually, you can do that really easily by right clicking on a file in the "Sources" pane and selecting "Map Network Resource":

{{< figure src="/images/source_maps/map_to_network_resource.png" alt="Google asking to map network resources" class="smaller" >}}

Then select the network resource that corresponds to your local file:

{{< figure src="/images/source_maps/mapping_to_network.png" alt="Map network resources to Chrome's workspace" class="smaller" >}}

Now any changes you make here will be automatically saved to the file system. Nice! If you ever get stuck or it seems like you're not seeing what you should be seeing, try refreshing the page and closing and re-opening the inspector before you spend a lot of time searching for answers.

## A Couple Notes

There are a couple of other things worth mentioning. One I brought up earlier, and that's that you might want to add `*.css.map` to your `.gitignore` file. Source maps are really just for development, so you can keep them out of your source control. Another is integration with Rails. A big problem with Rails is the assset pipeline. It doesn't use the latest version of sass and as a result making source maps work can be a bit of a challenge. As far as I know, there isn't a simple way to use sourcemaps with Rails. If you know of one I'd love to hear about it. There is a [gem for Rails sourcemaps](https://github.com/vhyza/sass-rails-source-maps) but I couldn't get it up and running. The documentation makes it sound like even if you could, you wouldn't get auto-recompiling and auto-reloading anyway, which for me are the killer features of using an external front-end solution.

## Enjoy Writing Sass

Hopefully this makes your life a little easier. Sourcemaps have definitely made me hate web design much much less and they save me a ton of time. Working with gulp has also completely changed by attitude toward front-end development. A problem with Rails is that it really is best suited for back-end development, and using it's opinionated (and, unfortunately, dated) setup for front end development can make that so much more frustrating than it needs to be. Gulp is great for things like dealing with sass files, but it can also automate most of your other front-end tasks. And it's just one of many solutions out there for these kinds of problems. Saving the hassle of debugging compiled CSS files and switching back and forth between an editor and the browser has been great. Hope you find it useful, too, and until next time, happy coding!

