+++
date = "2016-05-28T23:55:06-04:00"
title = "Setting Up Sass Source Maps and Autoprefixing With Gulp"
+++

Using sourcemaps with your sass files makes your front-end workflow even more awesome. With source maps you can make changes to your sass files directly in Chrome's browser inspector and save them directly to the actual files. No more tweaking design in the inspector and then trying to find the right place among your list of sass files to add those changes to your project. Source maps also make debugging CSS issues so simple because clicking on the style definition for an element will take you right to the line of sass where that style is defined -- not to a compiled (maybe minified) huge css file. Adding source maps to your project is super simple, especially if you already have tools in place to compile your sass files. I use [gulp to compile my sass files]({{<relref "2016.04.27-setting-up-gulp-for-css-pre-and-post-processing.md" >}}) already, so adding sourcemaps was easy. Check out that post if you don't already have gulp set up in your project.

## Add Source Maps to Your Sass Pipeline

First, get the sourcemap builder for gulp.

```bash
# in your project directory, where your gulpfile.js is
npm install --save-dev gulp-sourcemaps
```

Then add sourcemaps to your gulpfile. Require it at the top with the other tools:

```js
var sourcemaps = require('gulp-sourcemaps');
```

Then pipe your sass files into the sourcemaps initializer before they're compiled and write the sourcemaps right before they're output. You're whole `gulp.task('sass')` should look something like this:

```js
gulp.task('sass', function() {
  return gulp
    .src(input)
    .pipe(sourcemaps.init())
    .pipe(sass().on('error', sass.logError))
    .pipe(sourcemaps.write('./'))
    .pipe(gulp.dest(output));
});
```

You can change the output location for the sourcemap file by passing a relative path in this line:

```js
.pipe(sourcemaps.write('/your/custom/path/here'))
```

If you do not pass anything to `.write()`, `gulp-sourcemaps` will write the sourcemaps inline by default. IMO it's nicer to have them all in one file so you can `.gitignore` it and not interfere with any teammates' development environments. [Gulp sass has lots of other options](https://www.npmjs.com/package/gulp-sourcemaps) you can check out to customize it exactly how you want.

## Enable Sourcemaps in Chrome

To take full advantage of sourcemaps you have to tell Chrome that your compiled CSS has them by enabling a setting. Open the inspector, go to settings (press F1), scroll down to "Sources" and check "Enable CSS source maps" and "Auto-reload generated CSS". While you're here, you can adjust the default spacing to make it the same as your editor to avoid having different indentation between files edited in your editor and in Chrome's workspace.

{{< figure src="/images/source_maps/enable_source_maps.png" alt="Enabling source maps in Google Chrome" caption="Enabling source maps in Chrome" class="smaller" >}}

## Tell Chrome Where to Find Your Files

** Fire up your local server **
I mentioned that with sourcemaps you can edit files directly in the inspector and have those changes persisted to the actual files. To make this happen you need to tell the Chrome workspace where on your machine it can find the files to write your changes to. If you refresh your web page once you have `gulp-sourcemaps` set up and go to the "Sources" tab, you should see a friendly prompt from Chrome to guide you:

{{< figure src="/images/source_maps/serving_from_the_file_system.png" alt="Google prompt asking about serving from the file system" class="smaller" >}}

If you don't see this that's fine, just go ahead and either drag your folder with all the sass files in it into the workspace or right-click in the sources pane and select "Add Folder to Workspace":

{{< figure src="/images/source_maps/add_folder_to_workspace.png" alt="Add a local folder to Google Chrome workspace" class="smaller" >}}

Make sure that you give Chrome access to the folder when it asks:

{{< figure src="/images/source_maps/chrome_access_request.png" alt="Give Google Chrome access to the folder" class="smaller" >}}

Then, refresh your page and inspect something. You should see your source maps in action!

{{< figure src="/images/source_maps/woohoo_source_maps.png" alt="Source maps showing links to sass files" caption="Woohoo! Source maps are awesome." class="smaller" >}}

There's still one last thing to do to enable one of the coolest features of sourcemaps -- editing in the Chrome workspace. If you click on one of the links beside the style definitions in your inspector, Chrome will take you to the corresponding file in your workspace. You will probably see a prompt like this one:

{{< figure src="/images/source_maps/map_prompt.png" alt="Google asking to map network resources" caption="Woohoo! Source maps are awesome." class="smaller" >}}

If you do, click the link to "Establish the mapping now...". Chrome is pretty smart so once you map one file it will most likely pick up on the rest of your files automatically and map them to the corresponding network resources. If you don't see this prompt or you need to create the mapping between your local files and the network files manually, you can do that really easily by right clicking on a file in the "Sources" pane and selecting "Map Network Resource":

{{< figure src="/images/source_maps/map_to_network_resource.png" alt="Google asking to map network resources" caption="Woohoo! Source maps are awesome." class="smaller" >}}

Now any changes you make here will be automatically saved to the file system. Nice!

If you ever get stuck or it seems like you're not seeing what you should be seeing, try refreshing the page and closing and re-opening the inspector before you spend a lot of time searching for answers.


## Enjoy Writing Sass

Hopefully this makes your life a little easier. Sourcemaps have definitely made me hate writing sass so much less. There are tons of other things you can do with gulp, too. Basically if there's something you find yourself doing manually, it can probably be automated.









-------------------------------------------
While we're at it, add autoprefixing to your css. There is no reason not to do this, especially once you already have a custom processing pipeling set up with gulp. This is just one more filter for your code to pass through. Add it with

```bash
npm install --save-dev gulp-autoprefixer
```

Add it to your gulpfile:
```bash
// at the top of your gulpfile.js with all the other requires
var autoprefixer = require('gulp-autoprefixer');

// after sourcemaps, but before output
.pipe(autoprefixer())
```

By default autoprefixer supports:
- browsers with over 1% marketshare
- last 2 versions of all browsers
- Firefox ESR
- Opera 12.1

You can set it up to use a custom configuration by passing it an array of options


** NOTE: this might cause problems depending on where in your gulpfile you add the autoprefixing -- I added it AFTER the sourec maps which caused `CssSyntaxError .... Missed Semicolon`. If this happens to you try rearranging the order of your pipes and recompiling.



--------------------------------------------------------------------------------------------

## Autoprefixing

I mentioned auto-prefixing above. Prefixing CSS rules is something I don't do by hand, for one because the prefixes change and it's a pain to update them manually, but also because it makes my stylesheets very ugly. Since we're on a roll, I'll show you how to add auto-prefixing to your gulp sass workflow. Start by getting `gulp-autoprefixer`, the same way we got the other packages.

```bash
# in your project root directory, where you package.json is:
npm install --save-dev gulp-autoprefixer
```

Then, go ahead and hook inject auto-prefixing into your sass processing pipeline:

```js
// in gulpfile.js
// require gulp-autoprefixer at the top of your `gulpfile` along with the other packages we're using
var autoprefixer = require('gulp-autoprefixer');

// run your code through the auto-prefixer after it is compiled but before it is output to its final destination
.pipe(autoprefixer(optionalSupportTheseBrowsers))
```

Autoprefixer uses [Browserslist](https://github.com/ai/browserslist) to determine which browsers to support. By default, those are:

  - browsers with over 1% marketshare
  - last 2 versions of all browsers
  - Firefox ESR

If that's fine with you, just leave the options in autoprefixer blank (delete `optionalSupportTheseBrowsers` above), but if you want to be more specific than that then define your options like this somewhere in your gulpfile:

```js
optionalSupportTheseBrowsers = {
  browsers: ['>5%', 'last 3 versions', 'Firefox ESR']
};
```

You can set it up to use a custom configuration by passing it an array of options


** NOTE: this might cause problems depending on where in your gulpfile you add the autoprefixing -- I added it AFTER the sourec maps which caused `CssSyntaxError .... Missed Semicolon`. If this happens to you try rearranging the order of your pipes and recompiling.
