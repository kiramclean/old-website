+++
date = "2016-04-27T20:56:34-04:00"
title = "Setting Up Gulp for CSS Pre- and Post- Processing"
+++

## Static Sites with Hugo

I recently rebuilt this blog with [hugo](http://gohugo.io), an awesome super fast static site builder made with Go. It does a great job of organizing your content into easy to manage sections. The main reason I switched from jekyll was that I was having trouble organizing my content into sensible categories and extending functionality, like adding tags or page-specific layouts.

The only downside of hugo, at least if you're a Rails developer, like me, is that it's BYO-front end. Coming from the world of Rails and other Ruby frameworks like jekyll, this was new for me. With Rails you just put your (usually crappy) CSS and JS code in the folders that come with the app and rails magically turns them into one long CSS or JS file that just appears in your deployed web app. Rails supports Coffeescript and Sass by default, and if you want to use any other pre- or post-processors, like slim templating or auto-prefixing, there's a gem for that. Adding these things to your app is as simple as adding a single line to your Gemfile and running `bundle`. Since I learned web development with Rails to begin with I completely took this for granted. Turns out Rails is just very smart and not every web app or static site generator knows what to do with Sass or Coffeescript, let alone how to make the rest of your website or app aware of the compiled files they spit out.

Hugo builds static sites, so you can only include vanilla CSS or JS. There are no preprocessors involved in the Hugo build process, so if you want to use Sass or Coffeescript, or even if you just want to spread out your front-end code over a bunch of files, you need to deal with turning them into a single static file yourself.

## Finding a Front-End Solution

Of course this is basically the definition of front-end development so there are a million solutions to this problem. When I set up my site, I knew I definitely did not want to be writing CSS by hand. I needed a tool that could take a bunch of sass files spread out wherever I want them, turn them into a single CSS file (and do it automatically whenever there's an update), and then add all the ugly vendor prefixes before finally dumping this file into a different directory (the static css folder of my hugo site).

After chatting with some awesome font-end developers I overthought this for a few hours and settled on gulp. There are many many other tools and workflows for dealing with this kind of process out there, but for one that works for simple needs like mine, gulp was a perfect fit. To learn how I set up gulp to deal with my front-end woes, read on. The first thing you'll need to do is [get gulp](https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md). They have great instructions in the readme you might want to check out, but basically just run

```bash
npm install --global gulp-cli
```

Next, install gulp in your project directory. If you're starting a new project or adding node dependencies for the first time to an existing one, first run `npm init` in your project folder. This will just add a `package.json` file for you and step you through adding some info about the project. It's also useful for keeping track of development dependencies.

```bash
# in your project root directory
npm install --save-dev gulp
```

We'll also need `gulp-sass` to handle our sass. The `--save-dev` flag tells npm to add gulp and gulp-sass to the `devDependency` list in your `package.json` file.

```bash
# still in your project root directory
npm install --save-dev gulp-sass
```

>There are a couple of other tools you need for this setup that I'm assuming you already have if you're the type of person reading this post. You'll also need `libsass` and `node` itself. If you're seeing something like `command not found: npm`, get node with `brew install node`, if you're on OSX, or use your favourite package manager for your system.

## Configuring Gulp

Next you have to configure gulp. This is the part that sounds like a nightmare for people who aren't used to front-end work, but it's actually really simple.

First, create a `gulpfile.js` in your project root directory and add these two lines to initialize gulp and gulp-sass:

```js
// in ./gulpfile.js, which you probably have to create
var gulp = require('gulp');
var sass = require('gulp-sass');
```

Next, we need to tell gulp where to find the sass files and where to put the compiled css. Gulp works by running 'tasks', which are basically just lists of instructions telling the computer what to do. I guess that's what all code is. Whatever. Here is a simple gulp task that grabs the sass source files from one place, turns them into css using `gulp-sass` and dumps them in another. I'll run through it line by line.

```js
1  gulp.task('sass', function() {
2  return gulp.src('sass/*')
3     .pipe(sass().on('error', sass.logError))
4     .pipe(gulp.dest('./static/css'));
5  });
```

- `1:` Define a new gulp task named `sass`
- `2:` Tell gulp where to find your sass source files, relative to the `gulpfile.js`. I only have `.sass` or `.scss` files in my `sass/` folder, so I just tell it to grab everything in there. A lot of people use something like `sass/*.sass` to specify only `.sass` files.
- `3:` Pass (`pipe`) all these files we just grabbed to `gulp-sass`. It'll know what to do. Also, show me a nice error message if sass fails to compile -- failing silently will just kill gulp and we'll have no idea where the code is broken.
- `4:` Tell gulp where to dump the compiled css, again relative to the `gulpfile.js`.
- `5:` Ugly punctuation to make this valid javascript

That's it. Now, just run `gulp sass` (or whatever you named your task) from the project root directory and watch your compiled css appear in the destination folder. While we're at it, there's one other thing that's super simple to set up and well worth it --  `gulp-sass` comes with a free watcher. It's nothing to set up and it means your sass will automatically re-compile any time a file being watched changes. To do it just add this to your `gulpfile.js`:

```js
1  gulp.task('sass:watch', function() {
2    gulp.watch('sass/*', ['sass']);
3  });
```

- `1:` Define a new gulp task named `sass:watch`
- `2:` Tell gulp what to watch (everything in the sass folder here -- `sass/*` -- but this can be anything you want), and what to do when something changes (run this array of commands, here just `sass`, defined above -- this array can contain multiple commands).

Now just open a terminal window and run `gulp sass:watch`, which will keep a watcher running with an eye on your sass files and recompile them anytime you save a change.

One last note about how sass works that affects how you organize your project files. Sass will build one `.css` file for every `.sass` file you have unless the `.sass` file is prefixed with an underscore, marking it as a partial. If you don't name your sass files with an underscore, don't forget to include all the corresponding `.css` files in the `<head>` of your website, or else the CSS won't be available. Or you can do what I do and prefix everything with an underscore except for one `main.sass` file that just imports all the others.

## Final `gulpfile.js`

So there it is. Setting up gulp is really simple and a great way to handle your front-end code. The final gulpfile at this point looks something like this:

```js
// ./gulpfile.js

var gulp = require('gulp');
var sass = require('gulp-sass');

// Some variables for less repitition
var input = './sass/*';
var output = './static/css/';

// Compile sass
gulp.task('sass', function() {
  return gulp
    .src(input)
    .pipe(sass().on('error', sass.logError))
    .pipe(gulp.dest(output));
});

// Watch input directory for changes to sass files
gulp.task('sass:watch', function() {
  gulp.watch(input, ['sass']);
});

```

There's a lot more you can do with gulp, like autoprefixing and sourcemaps. These are things I'll definitely get into in a future post. Until then, happy coding!
