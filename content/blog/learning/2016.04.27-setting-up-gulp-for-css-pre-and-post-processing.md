+++
date = "2016-04-27T20:56:34-04:00"
draft = true
title = "Setting Up Gulp for CSS Pre- and Post- Processing"
+++

## Static Sites with Hugo

I recently rebuilt this blog with [hugo](http://gohugo.io), an awesome super fast static site builder made with Go. It does a great job of organizing your content into easy to manage sections. The main reason I switched from jekyll was that I was having trouble organizing my content into sensible categories and extending functionality, like adding tags or page-specific layouts.

The only downside of hugo, at least if you're a Rails developer, like me, is that it's BYO-front end. Coming from the world of Rails and other Ruby frameworks like jekyll, this was new for me. With Rails you just put your (usually crappy) CSS and JS code in the folders that come with the app and rails magically turns them into one long CSS or JS file that just appears in your deployed web app. Rails supports coffeescript and sass by default, and if you want to use any other pre- or post-processors, like slim templating or auto-prefixing, there's a gem for that. Adding these things to your app is as simple as adding a single line to your Gemfile and running `bundle`. Since I learned web development with Rails to begin with I completely took this for granted. Turns out Rails is just very smart and not every web app or static site generator knows what to do with sass or coffeescript, let alone how to make the complete files they spit out work in your app.

Hugo builds static sites, so you can only include vanilla CSS or JS. There are no preprocessors involved in the Hugo build process, so if you want to use Sass or Coffeescript, or even if you just want to spread out your front-end code over a bunch of files, you need to deal with turning them into a single static file yourself.

## Finding a Front-End Solution

Of course this is basically the definition of front-end development so there are a million solutions to this problem. When I set up my site, I knew I definitely did not want to be writing CSS by hand. I needed a tool that could take a bunch of sass files spread out wherever I want them, turn them into a single CSS file (and do it automatically whenever there's an update), and then add all the ugly vendor prefixes before finally dumping this file into a different directory (the static css folder of my hugo site).

After chatting with some awesome font-end developers I overthought this for a few hours and settled on gulp. There are many many other tools and workflows for dealing with this kind of process out there, but for one that works for simple needs like mine, gulp was a perfect fit. To learn how I set up gulp to deal with my front-end woes, read on. The first thing you'll need to do is [get gulp](https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md). They have great instructions in the readme you might want to check out, but basically just run

```bash
npm install --global gulp-cli
```

Next, install gulp in your project directory. If you're starting a new project or adding node dependencies for the first time to an existing one, first run `npm init` in your project folder. This will just add a `package.json` file for you and step you through adding some info about the project. It's also useful for keeping track of development dependencies.

```bash
# in your project root directory
npm install --save-dev gulp
```

We'll also need `gulp-sass` to handle our sass. The `--save-dev` flag tells npm to add gulp and gulp-sass to the `devDependency` list in your `package.json` file.

```bash
# still in your project root directory
npm install --save-dev gulp-sass
```

>There are a couple of other tools you need for this setup that I'm assuming you already have if you're the type of person reading this post. You'll also need `libsass` and `node` itself. If you're getting something like `command not found: npm`, get node with `brew install node`, if you're on OSX, or use your favourite package manager for your system.

## Configuring Gulp

Next you have to configure gulp. This is the part that sounds like a nightmare for people who aren't used to front-end work, but it's actually really simple.

First, create a `gulpfile.js` in your project root directory and add these two lines to initialize gulp and gulp-sass:

```js
// in ./gulpfile.js, which you probably have to create
var gulp = require('gulp');
var sass = require('gulp-sass');
```

Next, we need to tell gulp where to find the sass files and where to put the compiled css. Gulp works by building 'tasks' that are basically lists of instructions of what to do. I guess that's what all code is. Whatever. Here is a simple gulp task that grabs the sass source files from one place and dumps them in another.

```js
gulp.task('sass', function() {               // define a new gulp task named sass
  return gulp.src('sass/*')           // tell gulp where to find your sass files, relative to the gulpfile.js
    // I have a mix of sass and scss files in my sass directory, but nothing else, so I just tell gulp to grap everything in there
    .pipe(sass().on('error', sass.logError)) // show error messages if sass fails to compile -- failing silently will just kill gulp
    .pipe(gulp.dest('./static/css'));        // tell gulp where to dump your compiled css
});

gulp.task('default', function() {         // we also want to watch the files, so we don't have to manually recompile every time we make some changes
  gulp.watch('sass/*.sass', ['sass']);    // tell gulp which files to watch and an array with commands to run when those files are changed
});
```

Sass will build a css file for every sass file you have unless you prefix it with an underscore. If you have a bunch of css files don't forget to include them all in your `<head>` tag, or just prefix all your sass files with an underscore so sass only builds one long css file.

And that's that. Setting up gulp is actually super simple.
